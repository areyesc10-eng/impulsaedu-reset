<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Restablecer contraseña | ImpulsaEDU</title>
<style>
  :root{ --brand:#004F57; --accent:#FF7A00; --accent2:#FF9E2C; --bg:#f6f8fb; --muted:#6b7a86; --ok:#17b26a; --err:#e54848; }
  body{ margin:0; font-family:'Segoe UI',Arial,sans-serif; background:linear-gradient(180deg,#f9fbfd,#eef3f7); min-height:100dvh; display:grid; place-items:center; padding:24px }
  .card{ width:min(780px,92vw); background:#fff; border-radius:22px; border:1px solid #eef1f4; box-shadow:0 18px 40px rgba(0,0,0,.08); overflow:hidden }
  .head{ display:flex; gap:14px; align-items:center; padding:24px 28px; background:linear-gradient(120deg,#fff,#f9fbff 60%,#fff3e6 100%); border-bottom:1px solid #eef1f4 }
  .logo{ width:56px; height:56px; border-radius:14px; background:#fff; display:grid; place-items:center; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,.08) }
  .logo img{ width:100%; height:100%; object-fit:contain }
  .title h1{ margin:2px 0 2px; font-size:26px; color:var(--brand) }
  .title p{ margin:0; color:var(--muted); font-size:14.5px }
  .body{ padding:24px 28px }
  .label{ font-size:13px; color:#475a64; margin:8px 0 6px }
  .input{ display:flex; align-items:center; gap:10px; border:1px solid #e2e6ea; border-radius:12px; padding:12px 14px; background:#fff; transition:border .2s, box-shadow .2s }
  .input:focus-within{ border-color:var(--accent); box-shadow:0 0 0 4px rgba(255,122,0,.14) }
  .input input{ width:100%; border:none; outline:none; font-size:15px; background:transparent }
  .toggle{ cursor:pointer; font-size:12.5px; color:var(--brand); padding:4px 8px; border-radius:8px }
  .toggle:hover{ background:#eaf4f6 }
  .strength{ height:8px; background:#edf1f4; border-radius:999px; overflow:hidden; margin:10px 0 }
  .strength span{ display:block; height:100%; width:0; background:#ffb74d; transition:width .25s, background .25s }
  .checks{ list-style:none; padding:0; margin:8px 0 0 }
  .checks li{ display:flex; align-items:center; gap:8px; font-size:14px; color:#6c7a86; margin:6px 0 }
  .dot{ width:12px; height:12px; border-radius:50%; background:#d7dee5 }
  .ok .dot{ background:var(--ok) } .bad .dot{ background:var(--err) }
  .hint{ color:#6c7a86; font-size:13px; margin-top:6px }
  .actions{ margin-top:16px; display:flex; gap:12px; flex-wrap:wrap; align-items:center }
  .btn{ flex:1 1 240px; border:none; color:#fff; font-weight:700; font-size:16px; padding:13px 18px; border-radius:12px; cursor:pointer; background:linear-gradient(90deg,var(--accent),var(--accent2)); box-shadow:0 8px 22px rgba(255,122,0,.35) }
  .status{ color:#b4232a; font-size:14px; margin-top:8px; min-height:20px }
  .foot{ padding:10px 28px 22px; color:#9aa7b3; font-size:12px }
  .overlay{ position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.45); backdrop-filter:blur(2px); z-index:9 }
  .box{ width:min(420px,90vw); background:#fff; border-radius:22px; padding:28px; text-align:center; box-shadow:0 18px 45px rgba(0,0,0,.25) }
  .okBadge{ width:92px; height:92px; margin:0 auto 10px; border-radius:50%; background:conic-gradient(#17b26a 0 360deg); display:grid; place-items:center; box-shadow:0 10px 26px rgba(23,178,106,.35) }
  .okBadge svg{ width:52px; height:52px; stroke:#fff; stroke-width:6; fill:none; stroke-linecap:round; stroke-linejoin:round; stroke-dasharray:100; stroke-dashoffset:100; animation:dash .8s .25s ease forwards }
  @keyframes dash{ to{ stroke-dashoffset:0 } }
</style>
</head>
<body>
  <div class="card">
    <div class="head">
      <div class="logo">
        <img src="https://xlfcgtonpfvpiepxiuut.supabase.co/storage/v1/object/public/public-pages/logo-impulsaedu.png" alt="ImpulsaEDU" onerror="this.style.display='none'">
      </div>
      <div class="title">
        <h1>Restablecer contraseña</h1>
        <p>Verificando tu enlace…</p>
      </div>
    </div>

    <div class="body">
      <div class="label">Nueva contraseña</div>
      <div class="input">
        <input id="p1" type="password" placeholder="Mínimo 8 caracteres" autocomplete="new-password">
        <span class="toggle" id="t1">Mostrar</span>
      </div>
      <div class="strength"><span id="bar"></span></div>
      <ul class="checks">
        <li id="c-l"><span class="dot"></span> Al menos 8 caracteres</li>
        <li id="c-n"><span class="dot"></span> Incluye un número</li>
        <li id="c-u"><span class="dot"></span> Una mayúscula</li>
        <li id="c-s"><span class="dot"></span> Un símbolo (!@#$…)</li>
      </ul>

      <div class="label">Confirmar contraseña</div>
      <div class="input">
        <input id="p2" type="password" placeholder="Repite tu contraseña" autocomplete="new-password">
        <span class="toggle" id="t2">Mostrar</span>
      </div>
      <div class="hint" id="match"></div>

      <div class="actions">
        <button class="btn" id="save">Guardar nueva contraseña</button>
      </div>
      <div class="status" id="status"></div>
    </div>

    <div class="foot">© 2025 ImpulsaEDU — Impulsando tu desarrollo educativo</div>
  </div>

  <!-- Éxito -->
  <div class="overlay" id="done">
    <div class="box">
      <div class="okBadge"><svg viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"/></svg></div>
      <h2>¡Contraseña actualizada!</h2>
      <p>Ya puedes iniciar sesión con tu nueva contraseña.</p>
    </div>
  </div>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // === CREDENCIALES PÚBLICAS (válido para front) ===
    const SUPABASE_URL = 'https://xlfcgtonpfvpiepxiuut.supabase.co';
    const SUPABASE_ANON_KEY =
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhsZmNndG9ucGZ2cGllcHhpdXV0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3NjAwNjksImV4cCI6MjA3NTMzNjA2OX0.yNjOx9CWl1ia_q6tM_wKwYZwBHdgqKHyYNwdX-GSgg0';

    const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // ---- UI elements
    const t1 = document.getElementById('t1'), t2 = document.getElementById('t2');
    const p1 = document.getElementById('p1'), p2 = document.getElementById('p2');
    const bar = document.getElementById('bar'), matchHint = document.getElementById('match');
    const statusEl = document.getElementById('status'), done = document.getElementById('done');

    t1.onclick = ()=>{ p1.type = p1.type==='password' ? 'text':'password'; t1.textContent = p1.type==='password'?'Mostrar':'Ocultar'; }
    t2.onclick = ()=>{ p2.type = p2.type==='password' ? 'text':'password'; t2.textContent = p2.type==='password'?'Mostrar':'Ocultar'; }

    const mark = (id, ok)=>{ const el=document.getElementById(id); el.classList.remove('ok','bad'); el.classList.add(ok?'ok':'bad'); }
    function strength(v){
      const L=v.length>=8, N=/\d/.test(v), U=/[A-Z]/.test(v), S=/[^A-Za-z0-9]/.test(v);
      mark('c-l',L); mark('c-n',N); mark('c-u',U); mark('c-s',S);
      const score=[L,N,U,S].filter(Boolean).length;
      bar.style.width=[0,25,50,75,100][score]+'%';
      bar.style.background= score<=2 ? '#ffb74d' : (score===3?'#ff8a00':'#17b26a');
      return score;
    }
    p1.addEventListener('input', e=>strength(e.target.value));
